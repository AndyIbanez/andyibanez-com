<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.70.0" />

    
    
    

<title>Multithreading Options on Apple Platforms • Andy Ibanez</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Multithreading Options on Apple Platforms"/>
<meta name="twitter:description" content="Meet the multithreading tools offered by Apple on all their platforms, and learn to choose the right one for your needs."/>

<meta property="og:title" content="Multithreading Options on Apple Platforms" />
<meta property="og:description" content="Meet the multithreading tools offered by Apple on all their platforms, and learn to choose the right one for your needs." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.andyibanez.com/posts/multithreading-options-on-apple-platforms/" />
<meta property="article:published_time" content="2021-02-24T07:00:00-04:00" />
<meta property="article:modified_time" content="2021-02-24T07:00:00-04:00" /><meta property="og:site_name" content="Andy Ibanez - iOS Developer" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.e4368406c047b72036bd31fdf69f74f805156724914c166a0accb2369a218b61.css" integrity="sha256-5DaEBsBHtyA2vTH99p90&#43;AUVZySRTBZqCsyyNpohi2E=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    <script data-ad-client="ca-pub-3640551804216350" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-146179797-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://www.andyibanez.com">Andy Ibanez</a>
      </span>
      
      
        <div class="author-image">
          <img src="https://www.gravatar.com/avatar/196dd48d2ac425661edf58028d499370?s=240&d=mp" class="img--circle img--headshot element--center" alt="gravatar">
        </div>
      
      <p class="site__description">
         Software Developer from La Paz, Bolivia. Programming for iOS since 2011. 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Andy Ibanez</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/tags/wwdc2020/">
						<span>WWDC 2020</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/projects/">
						<span>Projects</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>About Me</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/privacy-policy/">
						<span>Privacy Policy</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/AndyIbanezK" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://facebook.com/AndyIbanezCom" rel="me"><i class="fab fa-facebook-f"></i></a>
	
	
	<a href="https://github.com/andyibanez" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	<a href="https://instagram.com/andyibanez" rel="me"><i class="fab fa-instagram fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://linkedin.com/in/andr%c3%a9s-iba%c3%b1ez-30234033" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://stackoverflow.com/users/648767" rel="me"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="https://keybase.io/andyibanez" rel="me"><i class="fab fa-keybase fa-lg" aria-hidden="true"></i></a>
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2021 Andrés Ibañez
  
</div>



  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Multithreading Options on Apple Platforms</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Feb 24, 2021
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/development">DEVELOPMENT</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/swift">swift</a>
           
      
          <a class="badge badge-tag" href="/tags/programming">programming</a>
           
      
          <a class="badge badge-tag" href="/tags/apple">apple</a>
           
      
          <a class="badge badge-tag" href="/tags/ios">ios</a>
           
      
          <a class="badge badge-tag" href="/tags/macos">macos</a>
           
      
          <a class="badge badge-tag" href="/tags/tvos">tvos</a>
           
      
          <a class="badge badge-tag" href="/tags/watchos">watchos</a>
           
      
          <a class="badge badge-tag" href="/tags/ipados">ipados</a>
           
      
          <a class="badge badge-tag" href="/tags/multithreading">multithreading</a>
           
      
          <a class="badge badge-tag" href="/tags/nsoperation">nsoperation</a>
           
      
          <a class="badge badge-tag" href="/tags/gcd">gcd</a>
           
      
          <a class="badge badge-tag" href="/tags/grand-central-dispatch">grand central dispatch</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 7 min read
</div>


  </header>
  
  
  <div class="post">
    <p>We have reached the point in which computers are really fast. Especially Apple&rsquo;s, as they have control of both the hardware and software, so, oftentimes, some tasks that could be sped up with multithreading, are not necessary anymore. But, for those cases when you do need multithreading, we have many options available.</p>
<p>On Apple&rsquo;s platforms there is a surprising amount of concurrency tools. You are likely familiar with the most used one, the Grand Central Dispatch, <code>DispatchQueue</code>, which is pretty good and it covers the vast majority of use cases. But there are some tasks that can be done easier with other tools.</p>
<p>In this article, we will explore and introduce the concurrency options that we can use:</p>
<ul>
<li>The <code>NSOperationQueue</code> APIs</li>
<li>Grand Central Dispatch (GCD)</li>
<li>NSThreads</li>
<li>pthreads</li>
</ul>
<p>Along with a quick discussion on when you may prefer to use a tool over another tool.</p>
<p>I have sorted the tools by their &ldquo;level&rdquo; in terms of high-level or low-level APIs, where the higher level ones show up first.</p>
<p>This article assumes you are familiar with concurrency and why it&rsquo;s important in the context of iOS, macOS, watchOS, and tvOS apps.</p>
<h1 id="the-nsoperationqueue-apis">The NSOperationQueue APIs</h1>
<p>NSOperation and its related APIs are actually one of my favorite set of tools we have for concurrency, not only on Apple&rsquo;s platforms, but overall.</p>
<p>These APIs are very high level, and as such they offer us some features that don&rsquo;t exist, or are harder to implement in other concurrency technologies.</p>
<p>NSOperationQueue and co. allow us to easily set tasks that depend on others, so you can easily start a concurrent task after another concurrent task has finished. It also allows you easily cancel other tasks.</p>
<p>You submit operations to a <code>NSOperationQueue</code> in the form of blocks, so it even offers really high level syntax.</p>
<p>I won&rsquo;t be talking much about these APIs here - despite the fact that I <em>love</em> <code>NSOperationQueue</code> -, because I have dedicated a whole article to it which you can find here: <a href="https://www.andyibanez.com/posts/exploring-the-nsoperation-apis/">Exploring the NSOperation APIs for Apple&rsquo;s Platforms</a></p>
<p>In general, I like using these APIs when I have to setup dependencies between tasks and I want an easy way to cancel them. Think of an app that can batch-download pictures and apply a filter to them without freezing your main thread.</p>
<h1 id="the-grand-central-dispatch">The Grand Central Dispatch</h1>
<p>Whether you know the Grand Central Dispatch (we will simply call it GCD from now on) by its name or not, you have undoubtedly used it in many of your apps, especially if you used Apple-provided APIs that return their result in a different thread (such as <code>URLSession</code>). Does this line look familiar to you?</p>
<pre><code>DispatchQueue.main.async {
  // Do something on the main thread
}
</code></pre><p>I&rsquo;d be familiar if you never saw that particular line of code before.</p>
<p>The GCD is a set of concurrency APIs, developed by Apple themselves, which make it easy to support multi-core processors and other types of symmetric processing systems.</p>
<p>I want you to pay particular attention to that definition, because the GCD was built for multi-core processors, not just Apple&rsquo;s, and this is where one of its biggest advantages come into play. The GCD is actually <a href="https://apple.github.io/swift-corelibs-libdispatch/">open source</a>, so if you learn to use it on Apple&rsquo;s technologies, you are likely to find implementations of it on other entirely different platforms of all shapes and sizes, as long as they can run C, C++, Objective-C, or Swift.</p>
<p>The GCD is also a great little tool to make quick concurrent tasks easily, quickly, and without writing any ugly code. One of the most common uses for it among Apple platform developers is dispatching UI-updating tasks into the main thread after using asynchronous APIs such as <code>URLSession</code>.</p>
<p>One other common use is to delay the current execution of the thread for a definitive amount of time, which can sometimes be useful. In Swift in particular, this has a very nice syntax.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift">DispatchQueue.main.asyncAfter(deadline: .now() <span style="color:#f92672">+</span> .seconds(<span style="color:#ae81ff">5</span>)) {
  <span style="color:#75715e">// This will be executed in the main thread after five seconds.</span>
}
</code></pre></div><p>The block above will execute some code in the <code>.main</code> thread after five seconds.</p>
<p>Another great feature of the GCD is that it allows us to specify the priority of each task when submitting them into a queue. This way we can help the queue execute important task fasters by providing a <code>QOS</code> (quality of service) parameter.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift">DispatchQueue.global(qos: .userInteractive).async {
  <span style="color:#75715e">// Any user-initiatied or user-interactive task has higher priority.</span>
}

DispatchQueue.global(qos: .utility).async {
  <span style="color:#75715e">// Tasks with uility QoS have lower priority.</span>
}
</code></pre></div><p>The GCD provide us with a ready to use global queue where we can submit tasks to (and yes, you can create your own queues). There are multiple QoS flags you can provide depending on the perceived priority of the task:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift">@available(macOS <span style="color:#ae81ff">10.10</span>, iOS <span style="color:#ae81ff">8.0</span>, <span style="color:#f92672">*</span>)
<span style="color:#66d9ef">case</span> background

@available(macOS <span style="color:#ae81ff">10.10</span>, iOS <span style="color:#ae81ff">8.0</span>, <span style="color:#f92672">*</span>)
<span style="color:#66d9ef">case</span> utility

@available(macOS <span style="color:#ae81ff">10.10</span>, iOS <span style="color:#ae81ff">8.0</span>, <span style="color:#f92672">*</span>)
<span style="color:#66d9ef">case</span> `<span style="color:#66d9ef">default</span>`

@available(macOS <span style="color:#ae81ff">10.10</span>, iOS <span style="color:#ae81ff">8.0</span>, <span style="color:#f92672">*</span>)
<span style="color:#66d9ef">case</span> userInitiated

@available(macOS <span style="color:#ae81ff">10.10</span>, iOS <span style="color:#ae81ff">8.0</span>, <span style="color:#f92672">*</span>)
<span style="color:#66d9ef">case</span> userInteractive

<span style="color:#66d9ef">case</span> unspecified
</code></pre></div><p>In the future, I may write a dedicated article to the GCD. In the meantime, keep in mind the GCD is great to use when:</p>
<ol>
<li>You need a quick way to &ldquo;switch between&rdquo; threads.</li>
<li>You need to specify priorities in your tasks and you want the system to prioritize them depending on a QoS flag.</li>
<li>You are potentially interested in using this amazing multithreading technology outside of Apple provided technologies.</li>
</ol>
<h1 id="nsthreads-and-pthreads">NSThreads and pthreads</h1>
<p>I&rsquo;m lumping these two together because they are both really low level, they have much more flexibility, and because their application is very similar: When you need direct control over thread creation and concurrency.</p>
<p>The GCD and NSOperation APIs have one thing in common: They handle all the actual thread management for you. When you are working with the GCD and NSOperation APIs, the system will choose when to create threads, when to destroy, when to dispatch them, and even where to dispatch them - see, NSOperation is particularly smart, and it won&rsquo;t actually do multithreading if it finds itself in a situation where not leaving the current thread is fine.</p>
<p>Sometimes though, computer smartness ain&rsquo;t actually smart, and you may find yourself in situations (although <em>very rarely</em>) in which you just aren&rsquo;t getting the behavior you want with the GCD or NSOperation*. For those cases, we can manually take control of threading with NSThreads and pthreads.</p>
<p>pthreads are the lowest-level APIs. They are POSIX threads, meaning you can create and use pthread in any POSIX system. They are implemented in pure C. I won&rsquo;t be mentioning them much do their extremely niche use cases, but be aware they exist, and <a href="https://computing.llnl.gov/tutorials/pthreads/">have the documentation</a> shall you be the one in a million dev who needs to drop down to such levels.</p>
<p>NSThreads, on the other hand, are bit more useful to most developers, even though they will not be touched by the vast majority of them. I think NSThreads have one particular advantage, and that is that the interface is very similar to Java threads. If you have worked with threads in Java, NSThread has a similar enough interface to make it easy to move among both languages. NSThread is a Foundation object, so it&rsquo;s good to keep that in mind.</p>
<p>Use NSThread when you need to have full control over concurrency, including thread creation and management (and as long as you are going to be responsible with your resource usage).</p>
<p><a href="https://developer.apple.com/documentation/foundation/nsthread">NSThread docs</a></p>
<h1 id="conclusion">Conclusion</h1>
<p>Multithreading is complicated and to this day it is a hard problem to solve. Apple provides us with many options to deal with multithreading. NSOperation is great and high level, but GCD gets the job done very often. Balancing your options is important to become a better iOS developer.</p>

    <hr>

  <p>If you find any inaccuracies (and that includes typos) or problems in this article please tweet at me (<a href="https://twitter.com/AndyIbanezK" target="_blank">@AndyIbanezK</a>) or send me an e-mail to website[at]andyibanez[dot]com.</p>

  <p>Please do not e-mail to ask me to cross-promote your website or any other soliciting of that kind. AndyIbanez.com is a personal blog, and unless there's a chance to enter a sponsorship relationship with you, I may ignore your message.</p>

  <p>Thank you for helping me improve the quality of my blog!</p>
  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/optionset-in-swift/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">OptionSet in Swift</span>
    </a>
    
    
    <a href="/posts/what-i-learned-from-selling-an-app/" class="navigation-next">
      <span class="navigation-tittle">What I Learned From Selling an App</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    
        <script src="https://utteranc.es/client.js"
        repo="AndyIbanez/andyibanez-com"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
    


</article>


        </div>
        
    

  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-146179797-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>


    
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/swift.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/objectivec.min.js"></script>
            
        
    
    <script type="text/javascript">
        
        hljs.configure({languages: ["swift, objectivec"]});
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
