<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.70.0" />

    
    
    

<title>Building URLs With NSURLComponents • Andy Ibanez</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Building URLs With NSURLComponents"/>
<meta name="twitter:description" content="Learn to build URLs Swiftly with NSURLComponents."/>

<meta property="og:title" content="Building URLs With NSURLComponents" />
<meta property="og:description" content="Learn to build URLs Swiftly with NSURLComponents." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.andyibanez.com/posts/building-urls-with-nsurlcomponents/" />
<meta property="article:published_time" content="2019-09-04T07:00:00-04:00" />
<meta property="article:modified_time" content="2019-09-04T07:00:00-04:00" /><meta property="og:site_name" content="Andy Ibanez - iOS Developer" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.e4368406c047b72036bd31fdf69f74f805156724914c166a0accb2369a218b61.css" integrity="sha256-5DaEBsBHtyA2vTH99p90&#43;AUVZySRTBZqCsyyNpohi2E=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    <script data-ad-client="ca-pub-3640551804216350" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-146179797-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://www.andyibanez.com">Andy Ibanez</a>
      </span>
      
      
        <div class="author-image">
          <img src="https://www.gravatar.com/avatar/196dd48d2ac425661edf58028d499370?s=240&d=mp" class="img--circle img--headshot element--center" alt="gravatar">
        </div>
      
      <p class="site__description">
         Software Developer from La Paz, Bolivia. Programming for iOS since 2011. 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Andy Ibanez</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/tags/wwdc2020/">
						<span>WWDC 2020</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/projects/">
						<span>Projects</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>About Me</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/privacy-policy/">
						<span>Privacy Policy</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/AndyIbanezK" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://facebook.com/AndyIbanezCom" rel="me"><i class="fab fa-facebook-f"></i></a>
	
	
	<a href="https://github.com/andyibanez" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	<a href="https://instagram.com/andyibanez" rel="me"><i class="fab fa-instagram fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://linkedin.com/in/andr%c3%a9s-iba%c3%b1ez-30234033" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://stackoverflow.com/users/648767" rel="me"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="https://keybase.io/andyibanez" rel="me"><i class="fab fa-keybase fa-lg" aria-hidden="true"></i></a>
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2021 Andrés Ibañez
  
</div>



  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Building URLs With NSURLComponents</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Sep 4, 2019
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/development">DEVELOPMENT</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/swift">swift</a>
           
      
          <a class="badge badge-tag" href="/tags/programming">programming</a>
           
      
          <a class="badge badge-tag" href="/tags/apple">apple</a>
           
      
          <a class="badge badge-tag" href="/tags/ios">ios</a>
           
      
          <a class="badge badge-tag" href="/tags/macos">macos</a>
           
      
          <a class="badge badge-tag" href="/tags/tvos">tvos</a>
           
      
          <a class="badge badge-tag" href="/tags/watchos">watchos</a>
           
      
          <a class="badge badge-tag" href="/tags/ipados">ipados</a>
           
      
          <a class="badge badge-tag" href="/tags/urls">urls</a>
           
      
          <a class="badge badge-tag" href="/tags/networking">networking</a>
           
      
          <a class="badge badge-tag" href="/tags/nsurl">nsurl</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 5 min read
</div>


  </header>
  
  
  <div class="post">
    <p>If you have been programming for Apple platforms for a while, chances are you have seen (or maybe even wrote yourself) a line of code that looks like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#66d9ef">let</span> url = URL(string: <span style="color:#e6db74">&#34;https://www.google.com/search?hl=en&amp;q=pullip&#34;</span>)<span style="color:#f92672">!</span>
</code></pre></div><p>Whether you wrote it yourself or someone else did it, one thing is clear: This is not a safe way to build URLs. Can you know, for sure, that your URL is actually valid? Intuitively, all of us can see a URL and see if it&rsquo;s valid, but there is a <a href="http://www.faqs.org/rfcs/rfc1738.html">whole lot of governing</a> in the URL format that at some point we may find funny URLs that look valid and aren&rsquo;t, or the other way around; they look invalid, but aren&rsquo;t.</p>
<p>In this article we will explore a very handy class for both URL composition and decomposition: <code>NSURLComponents</code>.</p>
<h1 id="introduction-to-nsurlcomponents">Introduction to NSURLComponents</h1>
<p>Calling web APIs is a very common task that the vast majority of developers are going to do at some point. To do that, the iOS/iPadOS, macOS, TVOS, and watchOS SDKs have a nice set of tools that make networking easier. The process of creating a URL seems obvious with the simple <code>init(string:)</code> constructor of <code>NSURL</code>, but a URL has many more components, and it may be easier to write a bit more code to ensure you actually have a valid URL.</p>
<p><code>NSURLComponents</code> is a class that allows us to both build URLs and decompose them into their essential parts. Using it, we can safely build valid URLs by just passing in the parts (components) we need. Other than making it easier to build URLs, it also handles some encoding details for us, so we don&rsquo;t have to care about escaping characters ourselves, especially in query strings.</p>
<h2 id="building-urls">Building URLs</h2>
<p>Let&rsquo;s go back to the old URL we used as an example at the beginning of this article.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#66d9ef">let</span> url = URL(string: <span style="color:#e6db74">&#34;https://www.google.com/search?hl=en&amp;q=pullip&#34;</span>)<span style="color:#f92672">!</span>
</code></pre></div><p>We will try to build this URL using <code>NSURLComponents</code>. It is a little bit more code, but the peace of mind is worth it, and it also helps us understand how URLs work a bit better, without having to refer to the entirety of RFC-1738.</p>
<p>First, we will build the URL up to the <code>/search</code> components, and we will be excluding the query (everything after the <code>?</code>).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#66d9ef">var</span> components = URLComponents()
components.scheme = <span style="color:#e6db74">&#34;https&#34;</span>
components.host = <span style="color:#e6db74">&#34;www.google.com&#34;</span>
components.path = <span style="color:#e6db74">&#34;/search&#34;</span>
<span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> url = components.url {
    print(<span style="color:#e6db74">&#34;URL: </span><span style="color:#e6db74">\(</span>url<span style="color:#e6db74">)</span><span style="color:#e6db74">&#34;</span>)
}
</code></pre></div><p>Like we would expect, this will print <code>URL: https://www.google.com/search</code>. This an example of a very simple URL, but be aware that URLs may have some additional components (and we do not need to set all the properties in order for them to be valid). For example, not all URLs have a <code>path</code>, and we can safely ignore the <code>host</code> and <code>schema</code> too. Try deleting these properties and see what URL you get back.</p>
<p>There&rsquo;s a few additional components in URLs that we will not cover in this article, but it&rsquo;s worth mentioning them:</p>
<ul>
<li><code>fragment</code>: If a URL contains a <code>#</code> symbol, the <code>fragment</code> is everything after it.</li>
<li><code>user</code> and <code>password</code>: Some URLs require some basic authentication to access them. We can use these properties for such credentials (i.e. <code>https://andy:masterpassword@www.google.com</code>).</li>
<li><code>port</code>: If we need to specify the port of a resource, this is the right property.</li>
<li><code>query</code>: We will actually explore this one, but not as a string component. The <code>query</code> of a URL is everything after a <code>?</code> sign.</li>
</ul>
<h3 id="urls-with-queries">URLs with Queries</h3>
<p>The query part of a URL (everything after a <code>?</code>) is composed of zero or more key-value pairs.</p>
<p>To build the <code>query</code> component of a URL, we could use <code>NSURLComponents</code>&rsquo; <code>query</code> property, which is a string. This is a quick and dirty way of doing it, but we lose some safety and if we use this, we might as well not use <code>NSURLComponents</code> at all.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift">components.query = <span style="color:#e6db74">&#34;hl=en&amp;q=pullip&#34;</span>
</code></pre></div><p>What we should use instead is use another class whose only purpose is to create these key-value pairs. That class is <code>URLQueryItem</code>, and it&rsquo;s very easy to use. It has one simple constructor which takes the <code>name</code> of the parameter (the &ldquo;key&rdquo;), and the value of it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#66d9ef">let</span> hl = URLQueryItem(name: <span style="color:#e6db74">&#34;hl&#34;</span>, value: <span style="color:#e6db74">&#34;en&#34;</span>)
<span style="color:#66d9ef">let</span> q = URLQueryItem(name: <span style="color:#e6db74">&#34;q&#34;</span>, value: <span style="color:#e6db74">&#34;pullip doll&#34;</span>)

components.queryItems = [hl, q]
</code></pre></div><p>We all love Swift, so let&rsquo;s take a moment to make this Swiftier:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift">components.queryItems = [<span style="color:#e6db74">&#34;hl&#34;</span>: <span style="color:#e6db74">&#34;en&#34;</span>, <span style="color:#e6db74">&#34;q&#34;</span>: <span style="color:#e6db74">&#34;pullip&#34;</span>]
    .map { URLQueryItem(name: $0, value: $1) }
</code></pre></div><p>With this, we can now build our query strings with the certainty that they are going to be valid when building URLs.</p>
<h1 id="decomposing-urls-into-their-components">Decomposing URLs Into Their Components</h1>
<p><code>NSURLComponents</code> can be used for both composing and decomposing URLs. This is very useful, specially if we use the URL mechanism Apple has in place for app communication.</p>
<p>One such example of this is iOS with its URL app launching mechanism. Our apps can register <code>scheme</code>s to launch other apps, and also other apps can launch ours if they register our scheme.</p>
<p>When an app launches ours, this application delegate method is called:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift">application(<span style="color:#66d9ef">_</span>:url:options:)
</code></pre></div><p>And we can use this to perform certain tasks in our app.</p>
<p>We could decide that an app calling this URL is going to print the passed text into the console:</p>
<p><code>myapp://print?text='Hello+Alice'</code></p>
<p>You could try to grab the underlying string of the passed <code>NSURL</code>, splitting the string with a token and parsing the components ourselves. But this takes a lot of work, is error prone, and there&rsquo;s no need to do it since <code>NSURLComponents</code> can do it for us.</p>
<p>In the following code, we will decompose the above URL with <code>NSURLComponents</code>, grab the <code>text</code> query parameter, and prints its value.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">application</span>(<span style="color:#66d9ef">_</span> app: UIApplication, open url: URL, options: [UIApplication.OpenURLOptionsKey : Any] = [:]) -&gt; Bool {
    <span style="color:#66d9ef">let</span> components = URLComponents(url: url, resolvingAgainstBaseURL: <span style="color:#66d9ef">true</span>)
    components?.queryItems?.forEach {
        <span style="color:#75715e">// In case our app grows and we start passing in bigger queries with the URLs, we will check we grab the ones we need and work with each parameter as required.</span>
        <span style="color:#66d9ef">if</span> $0.name == <span style="color:#e6db74">&#34;text&#34;</span> {
            print($0.value ?? <span style="color:#e6db74">&#34;&#34;</span>)
        }
    }
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>
}
</code></pre></div><h1 id="conclusion">Conclusion</h1>
<p>While <code>NSURLComponents</code> does require more code to write, using it has a lot of benefit. Automatic encoding, security, and peace of mind are some of the benefits it brings to us when building URLs. Being able to decompose existing URLs into their components is also a useful thing, especially on systems where app communication through URLs is prevalent.</p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/caching-content-with-nscache/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Caching Content With NSCache</span>
    </a>
    
    
    <a href="/posts/swift-result-type/" class="navigation-next">
      <span class="navigation-tittle">Understanding the Result Type in Swift</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    
        <script src="https://utteranc.es/client.js"
        repo="AndyIbanez/andyibanez-com"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
    


</article>


        </div>
        
    

  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-146179797-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>


    
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/swift.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/objectivec.min.js"></script>
            
        
    
    <script type="text/javascript">
        
        hljs.configure({languages: ["swift, objectivec"]});
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
