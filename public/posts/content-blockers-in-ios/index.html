<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.70.0" />

    
    
    

<title>Writing Content Blockers for iOS • Andy Ibanez</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Writing Content Blockers for iOS"/>
<meta name="twitter:description" content="Learn how to write Content Blockers for iOS."/>

<meta property="og:title" content="Writing Content Blockers for iOS" />
<meta property="og:description" content="Learn how to write Content Blockers for iOS." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.andyibanez.com/posts/content-blockers-in-ios/" />
<meta property="article:published_time" content="2020-05-20T07:00:00-04:00" />
<meta property="article:modified_time" content="2020-05-20T07:00:00-04:00" /><meta property="og:site_name" content="Andy Ibanez - iOS Developer" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.e4368406c047b72036bd31fdf69f74f805156724914c166a0accb2369a218b61.css" integrity="sha256-5DaEBsBHtyA2vTH99p90&#43;AUVZySRTBZqCsyyNpohi2E=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    <script data-ad-client="ca-pub-3640551804216350" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-146179797-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://www.andyibanez.com">Andy Ibanez</a>
      </span>
      
      
        <div class="author-image">
          <img src="https://www.gravatar.com/avatar/196dd48d2ac425661edf58028d499370?s=240&d=mp" class="img--circle img--headshot element--center" alt="gravatar">
        </div>
      
      <p class="site__description">
         Software Developer from La Paz, Bolivia. Programming for iOS since 2011. 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Andy Ibanez</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/tags/wwdc2020/">
						<span>WWDC 2020</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/projects/">
						<span>Projects</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>About Me</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/privacy-policy/">
						<span>Privacy Policy</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/AndyIbanezK" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://facebook.com/AndyIbanezCom" rel="me"><i class="fab fa-facebook-f"></i></a>
	
	
	<a href="https://github.com/andyibanez" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	<a href="https://instagram.com/andyibanez" rel="me"><i class="fab fa-instagram fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://linkedin.com/in/andr%c3%a9s-iba%c3%b1ez-30234033" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://stackoverflow.com/users/648767" rel="me"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="https://keybase.io/andyibanez" rel="me"><i class="fab fa-keybase fa-lg" aria-hidden="true"></i></a>
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2021 Andrés Ibañez
  
</div>



  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Writing Content Blockers for iOS</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> May 20, 2020
    
    
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/swift">swift</a>
           
      
          <a class="badge badge-tag" href="/tags/programming">programming</a>
           
      
          <a class="badge badge-tag" href="/tags/apple">apple</a>
           
      
          <a class="badge badge-tag" href="/tags/ios">ios</a>
           
      
          <a class="badge badge-tag" href="/tags/macos">macos</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 5 min read
</div>


  </header>
  
  
  <div class="post">
    <p>A few years ago, Apple introduced the Content Blocking APIs to Safari. Using these APIs, developers are able to write extensions that allow Safari to block content users do not want to see.</p>
<p>Most commonly used for ads, content blockers are not really <em>ad blockers</em>. While they can, and commonly do, block ads, developers can write content blockers for all kind of content, including profanity, or other questionable content.</p>
<h1 id="content-blocking-vs-ad-blocking">Content Blocking VS Ad Blocking.</h1>
<p>Content Blockers are actually very limited in terms of what they can do. We cannot really achieve the level of functionality especialized extensions such as AdBlock Plus have to offer. Apple&rsquo; implementation has two main focuses in mind:</p>
<ul>
<li>Privacy</li>
<li>Performance</li>
</ul>
<h2 id="privacy">Privacy</h2>
<p>When we write content blockers, we are just writing a set of rules that we hand to Safari, and then Safari takes care of the blocking based on those rules. The app that handed the browser these rules will never get any callbacks or notifications back from Safari when it finds content it needs to block. It is set-and-forget.</p>
<p>This has some privacy implications. First, developers have no access whatsoever to anything Safari blocks. There are some browser extensions that allow you to see statistics about blocked websites on the desktop. Because we don&rsquo;t have this level of control, we cannot really implement a feature similar to this.</p>
<p>Developers cannot track the content users block, and this goes in hand with Apple&rsquo;s policies on user data.</p>
<h2 id="performance">Performance</h2>
<p>Normal extensions that run in a browser have more access to resources, because they are packed with features. Because content blockers can&rsquo;t really execute any code on their own, the performance is blazing fast. Safari&rsquo;s parsing of these rules is incredibly efficient, and users are unlikely to see a negative impact on performance from this system.</p>
<p>Fun little fact: Content blockers were introduced in iOS 9, but only devices that had a 64-Bit processor could execute them. This means anything starting on the A7. The iPhone 5, while it did support iOS 9, it wasn&rsquo;t able to run content blockers.</p>
<h1 id="writing-content-blockers">Writing Content Blockers</h1>
<p>Here&rsquo;s the fun bit about content blockers:</p>
<p><strong>You don&rsquo;t need any actual code at all</strong></p>
<p>Yep. You read that right. At the most elemental level, content blockers are rules represented in a <code>JSON</code> file. Everything all the Content Blocker apps in the App Store do is create a JSON file that gets handed to Safari. You could theorically create an extensions that all it does is hand a static JSON file to Safari without writing a line of code.</p>
<p>If you create a new <code>Content Blocking Extension</code> on Xcode, the target has a <code>blockList.json</code> file. If you open it, it has content like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">[
    {
        <span style="color:#f92672">&#34;action&#34;</span>: {
            <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;block&#34;</span>
        },
        <span style="color:#f92672">&#34;trigger&#34;</span>: {
            <span style="color:#f92672">&#34;url-filter&#34;</span>: <span style="color:#e6db74">&#34;webkit.svg&#34;</span>
        }
    }
]
</code></pre></div><p>The extension does provide a Swift file called <code>ContentBlockerRequestHandler.swift</code>. This file has the bare minimum to create and work with your extension. You don&rsquo;t need to touch it at all, but know that you can use this file to customize your content blocker.</p>
<h2 id="the-blocklistjson">The blockList.json</h2>
<p>Back to the meaty parts of content blockers, the JSON file lets you add all the rules you want to use for blocking. And they are quite configurable, too. The JSON has two main keys:</p>
<p><code>action</code>: This is the action you want to perform on content that match the trigger.
<code>trigger</code>: This is the condition that should be met in order to execute your <code>action</code>.</p>
<h3 id="triggers">Triggers</h3>
<p>The trigger can be a combination of:</p>
<ul>
<li><code>url-filter</code>: This matches the URL in the navigation bar of the browser. It can be a regular expression.</li>
<li><code>url-filter-is-case-sensitive</code>: You can decide if the URL matching should be case sensitive. By default, it is case insensitive.</li>
<li><code>resource-type</code>: This is an array that let&rsquo;s you specify what kind of content should be blocked. Some valid values are <code>script</code> and <code>image</code>, but there&rsquo;s others.</li>
<li><code>load-type</code>: Is another array, you can specify if you want to let the website load its own content (<code>first-party</code>) and/or content from other URLs (<code>third-party</code>)</li>
<li><code>if-domain</code> and <code>unless-domain</code> let you specify a website to include or exclude from the rule.</li>
</ul>
<h3 id="actions">Actions</h3>
<p>Actions describe how the blocking should take place.</p>
<ul>
<li><code>block</code>: Blocks a content entirely, rewriting the HTML.</li>
<li><code>block-cookies</code>: allows you to block the cookies set by certain requests.</li>
<li><code>css-display-none</code>: Modifies the CSS to hide the content. When using this type, you need to provide a CSS selector (with the <code>selector</code> JSON property) to target the CSS you want to modify.</li>
<li><code>ignore-previous-rules</code>: You can override previous rules if they match a certain criteria.</li>
</ul>
<h2 id="writing-simple-content-blockers">Writing Simple Content Blockers.</h2>
<p>With that knowledge in hand, you could block Google and a bunch of their services writing a code like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift">[
    {
        <span style="color:#e6db74">&#34;action&#34;</span>: {
            <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;block&#34;</span>
        },
        <span style="color:#e6db74">&#34;trigger&#34;</span>: {
        <span style="color:#e6db74">&#34;url-filter&#34;</span>: <span style="color:#e6db74">&#34;.*google.*&#34;</span>
        }
    }
]
</code></pre></div><p>This simple rule will prevent Google from loading at all, and any URL that has <code>google</code> in it won&rsquo;t load, either.</p>
<p>If you wanted to block content that leads to Buzzfeed, you would write something like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift">[
    {
        <span style="color:#e6db74">&#34;action&#34;</span>: {
            <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;css-display-none&#34;</span>,
            <span style="color:#e6db74">&#34;selector&#34;</span>: <span style="color:#e6db74">&#34;a[href*=&#39;buzzfeed&#39;]&#34;</span>
        },
        <span style="color:#e6db74">&#34;trigger&#34;</span>: {
        <span style="color:#e6db74">&#34;url-filter&#34;</span>: <span style="color:#e6db74">&#34;.*&#34;</span>
        }
    }
]
</code></pre></div><p>This will block all Buzzfeed content, across all URLS.</p>
<h1 id="conclusion">Conclusion</h1>
<p>Content blockers are an old but very powerful extension. They allow us to write performant rules for blocking content in Safari while respecting our user&rsquo;s privacy.</p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/dependency-injection-storyboards/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Dependency Injection with Storyboards on Apple Platforms</span>
    </a>
    
    
    <a href="/posts/using-ios-keychain-swift/" class="navigation-next">
      <span class="navigation-tittle">Using the iOS Keychain in Swift</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    
        <script src="https://utteranc.es/client.js"
        repo="AndyIbanez/andyibanez-com"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
    


</article>


        </div>
        
    

  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-146179797-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>


    
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/swift.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/objectivec.min.js"></script>
            
        
    
    <script type="text/javascript">
        
        hljs.configure({languages: ["swift, objectivec"]});
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
