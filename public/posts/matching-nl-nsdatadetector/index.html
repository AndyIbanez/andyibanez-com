<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.70.0" />

    
    
    

<title>Matching Natural Language Text for Predefined Data Patterns on Apple&#39;s Devices • Andy Ibanez</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Matching Natural Language Text for Predefined Data Patterns on Apple&#39;s Devices"/>
<meta name="twitter:description" content="Learn to use the NSDataDetector class to match patterns in natural language."/>

<meta property="og:title" content="Matching Natural Language Text for Predefined Data Patterns on Apple&#39;s Devices" />
<meta property="og:description" content="Learn to use the NSDataDetector class to match patterns in natural language." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.andyibanez.com/posts/matching-nl-nsdatadetector/" />
<meta property="article:published_time" content="2020-02-05T07:00:00-04:00" />
<meta property="article:modified_time" content="2020-02-05T07:00:00-04:00" /><meta property="og:site_name" content="Andy Ibanez - iOS Developer" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.e4368406c047b72036bd31fdf69f74f805156724914c166a0accb2369a218b61.css" integrity="sha256-5DaEBsBHtyA2vTH99p90&#43;AUVZySRTBZqCsyyNpohi2E=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    <script data-ad-client="ca-pub-3640551804216350" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-146179797-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://www.andyibanez.com">Andy Ibanez</a>
      </span>
      
      
        <div class="author-image">
          <img src="https://www.gravatar.com/avatar/196dd48d2ac425661edf58028d499370?s=240&d=mp" class="img--circle img--headshot element--center" alt="gravatar">
        </div>
      
      <p class="site__description">
         Software Developer from La Paz, Bolivia. Programming for iOS since 2011. 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Andy Ibanez</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/tags/wwdc2020/">
						<span>WWDC 2020</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/projects/">
						<span>Projects</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>About Me</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/privacy-policy/">
						<span>Privacy Policy</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/AndyIbanezK" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://facebook.com/AndyIbanezCom" rel="me"><i class="fab fa-facebook-f"></i></a>
	
	
	<a href="https://github.com/andyibanez" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	<a href="https://instagram.com/andyibanez" rel="me"><i class="fab fa-instagram fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://linkedin.com/in/andr%c3%a9s-iba%c3%b1ez-30234033" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://stackoverflow.com/users/648767" rel="me"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="https://keybase.io/andyibanez" rel="me"><i class="fab fa-keybase fa-lg" aria-hidden="true"></i></a>
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2021 Andrés Ibañez
  
</div>



  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Matching Natural Language Text for Predefined Data Patterns on Apple&#39;s Devices</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Feb 5, 2020
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/development">DEVELOPMENT</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/swift">swift</a>
           
      
          <a class="badge badge-tag" href="/tags/programming">programming</a>
           
      
          <a class="badge badge-tag" href="/tags/apple">apple</a>
           
      
          <a class="badge badge-tag" href="/tags/ios">ios</a>
           
      
          <a class="badge badge-tag" href="/tags/ipados">ipados</a>
           
      
          <a class="badge badge-tag" href="/tags/tvos">tvos</a>
           
      
          <a class="badge badge-tag" href="/tags/watchos">watchos</a>
           
      
          <a class="badge badge-tag" href="/tags/macos">macos</a>
           
      
          <a class="badge badge-tag" href="/tags/natural-language">natural language</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 3 min read
</div>


  </header>
  
  
  <div class="post">
    <p>iOS has a lot of APIs that deal with natural language detection. One such class is <a href="https://developer.apple.com/documentation/foundation/nsdatadetector"><code>NSDataDetector</code></a>. This class allows you to match different kinds of data in text, including dates, time, links, and more. This class, actually introduced a very long time ago (in the iOS 4.0 days!) makes it very easy to find this kind of data in strings. In this article we will explore how to use this very old class - whose documentation is Objective-C only at this time - in Swift, and how to do common tasks with it.</p>
<p>This class is a subclass of <a href="https://developer.apple.com/documentation/foundation/nsregularexpression"><code>NSRegularExpression</code></a>, so you can expect it to not be entirely perfect with some data. For example, my country&rsquo;s addresses do not follow any kind of format used in developed countries, so address detection fails for me most of the time.</p>
<p>That said you can expect it to work with most data. Phone numbers, URLs, and dates/times are likely to be recognized without an issue.</p>
<h1 id="finding-patterns-in-natural-language">Finding Patterns in Natural Language.</h1>
<p>When you create an instance of this class, you specify what kind of content you want to find. A checking type is a <a href="https://developer.apple.com/documentation/foundation/nstextcheckingresult/checkingtype"><code>NSTextCheckingResult.CheckingType</code></a> object, and you can specify more than one at a time.</p>
<p>In the below example, we will create a data detector that can find links and dates in a string:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#66d9ef">let</span> detector = <span style="color:#66d9ef">try</span>! NSDataDetector(
  types: NSTextCheckingResult.CheckingType.link.rawValue <span style="color:#f92672">|</span> NSTextCheckingResult.CheckingType.date.rawValue
)
</code></pre></div><p>As we said earlier, this is an Objective-C API that comes from the early iOS days, so it may look a little bit weird (and ugly), but it works.</p>
<p>We need to use the <code>rawValue</code>s of the types, and we need to <code>or</code> them together. Swift cannot even infer the types, so we need to write quite a bit of verbose code.</p>
<p>Now we can use the detector to match content in a string.</p>
<p>We start by defining the string we want to match in, a few regex <a href="https://developer.apple.com/documentation/foundation/nsregularexpression/matchingoptions">matching options</a>, and the range of the string to check in.</p>
<pre><code>let string = &quot;Make sure you check out my website andyibanez.com tomorrow at 8 and on Friday&quot;
let range = NSRange(0..&lt;string.count)

let foundContent = detector.matches(
  in: string,
  options: [], range: range)
</code></pre><p>Once again, this being an old API, we need to use the good ol&rsquo; <code>NSRange</code> instead of the Swift&rsquo;s range. Other than that, nothing too bothersome here.</p>
<p>That will return an array of <a href="https://developer.apple.com/documentation/foundation/nstextcheckingresult"><code>NSTextCheckingResult</code></a>s, and you can just iterate over the elements:</p>
<pre><code>foundContent.forEach { content in
  switch content.resultType {
  case NSTextCheckingResult.CheckingType.link:
    print(&quot;URL: \(content.url!)&quot;)
  case NSTextCheckingResult.CheckingType.date:
    print(&quot;DATE: \(content.date!)&quot;)
  default:
    break
  }
}
</code></pre><p>There are different result types for different objects. The good news is, that once you know we have a certain type in the <code>switch</code>, we can just force-unwrap the expected element. The code above prints the following in my machine:\</p>
<pre><code>URL: http://andyibanez.com
DATE: Optional(2020-01-30 12:00:00 +0000)
DATE: Optional(2020-01-31 16:00:00 +0000)
</code></pre><p>Dates are in UTC, so you may need to operate on them when you  receive them. If your string contains text that can be used to deduce the timezone, you can access the <code>timezone</code> property of <code>NSTextCheckingResult</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift"><span style="color:#66d9ef">let</span> string = <span style="color:#e6db74">&#34;Visit me tomorrow at 8 UTC+4&#34;</span>
<span style="color:#75715e">//...</span>
<span style="color:#66d9ef">case</span> NSTextCheckingResult.CheckingType.date:
    print(<span style="color:#e6db74">&#34;DATE: </span><span style="color:#e6db74">\(</span>content.date!<span style="color:#e6db74">)</span><span style="color:#e6db74"> </span><span style="color:#e6db74">\(</span>content.timeZone<span style="color:#e6db74">)</span><span style="color:#e6db74">&#34;</span>)
<span style="color:#75715e">//...</span>
<span style="color:#75715e">// DATE: 2020-01-30 04:00:00 +0000 Optional(GMT+0400 (fixed))</span>
</code></pre></div><p>Note that the link was detected in a very smart way and you didn&rsquo;t even need to specify the protocol.</p>
<h1 id="conclusion">Conclusion</h1>
<p><code>NSDataDetector</code> is an old but still very powerful API. What we saw today is just the type of the iceberg of its features. This object can match other types of content as well. If you are interested, I encourage you to check out the documentation. It has some limitations, but it will for many cases.</p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/speech-recognition-sfspeechrecognizer/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Recognizing Speech Locally on an iOS Device Using the Speech Framework</span>
    </a>
    
    
    <a href="/posts/tokenizing-nltokenizer/" class="navigation-next">
      <span class="navigation-tittle">Tokenizing Natural Language into Semantic Units in iOS</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    
        <script src="https://utteranc.es/client.js"
        repo="AndyIbanez/andyibanez-com"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
    


</article>


        </div>
        
    

  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-146179797-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>


    
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/swift.min.js"></script>
            
                <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/languages/objectivec.min.js"></script>
            
        
    
    <script type="text/javascript">
        
        hljs.configure({languages: ["swift, objectivec"]});
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
